# メモ

cat > setup_dinov2_py311.sh /dev/null 2>&1; then
  curl -sS https://bootstrap.pypa.io/get-pip.py -o /tmp/get-pip.py
  sudo python3.11 /tmp/get-pip.py
fi
python3.11 -m pip install -U pip wheel setuptools

echo "[6/8] 仮想環境作成＆有効化"
mkdir -p ~/.venvs
python3.11 -m venv ~/.venvs/dinov2-py311
# shellcheck disable=SC1091
source ~/.venvs/dinov2-py311/bin/activate
python -V

echo "[7/8] PyTorch 2.0系（cu118想定）＋ xformers 0.0.18"
# ご主人さまがCUDA 12系なら index-url を cu128 に変更してください
pip install torch==2.0.1 torchvision==0.15.2 torchaudio==2.0.2 \
  --index-url https://download.pytorch.org/whl/cu118
pip install xformers==0.0.18

echo "[8/8] DINOv2導入と動作確認"
if [ ! -d dinov2 ]; then
  git clone GitHub - facebookresearch/dinov2: PyTorch code and models for the DINOv2 self-supervised learning method. (https://github.com/facebookresearch/dinov2.git)
fi
cd dinov2
pip install -r requirements.txt
pip install -e .

python - << 'PY'
import torch
print("Torch:", torch.__version__, "CUDA:", torch.version.cuda, "Avail:", torch.cuda.is_available())
m = torch.hub.load('facebookresearch/dinov2','dinov2_vitb14').eval()
x = torch.randn(1,3,518,518)
if torch.cuda.is_available():
    m = m.cuda(); x = x.cuda()
with torch.no_grad():
    y = m(x)
print("OK. output shape:", y.shape)
PY

echo "=== 完了 ==="
echo "次回以降: source ~/.venvs/dinov2-py311/bin/activate"
SH

bash setup_dinov2_py311.sh

作成日時: 2025-08-08 15:39:06