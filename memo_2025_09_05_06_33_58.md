# メモ

ご主人さま、
FLIP（ꟻLIP）は NVIDIA 研究が提案した**“交互表示（フリップ）で人が見分ける差”をまねて、参照画像とテスト画像の差を誤差マップで可視化し、単一スコアでも要約できる指標でございます。人の視覚特性（視距離・モニタ画素サイズなど）を入れて「目に映る差」**に寄せているのが要点でございます。

FLIPは何を解く？

2枚の画像（参照／テスト）を同位置・同解像で比べ、どこがどれだけ“見えて”違うかを誤差マップとして出します。研究のユーザスタディでは、従来指標（SSIM/LPIPS など）より人の知覚と対応の良いマップを出せたと報告されています。

1つの数値で要約する場合、著者らは**“加重中央値”ではなく“平均FLIP値（mean）を推奨”**と後注で明言しています。


仕組み（LDR-FLIPの概念フロー）

内部処理は論文・実装に基づき、おおむね次の流れでございます：

1. 色空間変換：画像を sRGB 等から**線形化した CIELAB 系（YyCxCz）**へ。


2. 見えやすさでの平滑化（CSF）：視距離・画素ピッチに応じた**コントラスト感度関数（CSF）**をガウシアン近似してチャンネル別に畳み込み、人には見えない細かすぎる差を減衰させます。


3. 明るさ依存の色強調（Hunt効果補正）：明るいほど色差が目立ちやすい性質を反映し、a,b 色差成分を L に応じてスケールします。


4. 特徴検出（エッジ／点）：ガウシアンの一次・二次微分でエッジ・点の特徴マップを作ります（差が輪郭上に出ると実際は目立ちやすい）。


5. 統合：色差と特徴差を組み合わせ、特徴部では色差を強める形で0〜1程度の誤差値に正規化した誤差マップを出力します。



> 公式実装も CIELAB 変換を高精度化するなどを明記しており（XYZ↔CIELAB の改良）、実装は継続的に整備されています。



LDR-FLIP と HDR-FLIP

LDR-FLIP：通常の低ダイナミックレンジ画像向けの基本形。HPG 2020 掲載のオリジナルで、視距離・画素サイズを明示的に扱います。

HDR-FLIP：高ダイナミックレンジ画像用の拡張。複数露出に自動補正＆トーンマップしたLDR誤差マップを合成して、HDRの“見える差”を可視化します。


出力の見方

誤差マップ：値が大きい（白に近い）ほど人に目立つ差。輪郭・高コントラスト部の誤差が強調されやすいです。

単一スコア：mean FLIPが推奨。小さいほど良い（差が目立たない）。


どんな場面で有効か

レンダラ／パストレーシング＋デノイザの評価：どこで破綻が見えるかを地図のように示せます。

画像編集・超解像の“元画像との整合”確認など、元と結果のフルリファレンス比較に。研究利用例でも FLIP を併用する報告が見られます。


実務での使い方（公式実装）

Python/CLI：

pip install flip-evaluator
flip -r reference.png -t test.png

PyTorch の損失関数、C++/CUDA 実装も用意されています。


パラメータと注意点

表示条件：視距離やモニタ画素サイズを設定できます。実際の観察条件に近づけるほど、結果は“見た目”に忠実になります。

前提：フルリファレンス指標なので、参照とテストの幾何整合（位置合わせ・同解像）が必須でございます。

ダイナミックレンジ：HDRはHDR-FLIPをご使用ください。

単一値の解釈：研究ページの注記どおり、平均値の採用が推奨です。ベンチマーク表を作る際はこの方針が安全でございます。



---

出典

NVIDIA Technical Blog（研究紹介・視距離/画素サイズ・ユーザスタディ・誤差マップ重視）

NVIDIA Research 公開ページ（論文情報・言語別実装・“mean FLIP 推奨”の注記・HDR 版の案内）

HDR-FLIP（露出補正とトーンマップの複合で HDR の誤差可視化）

参考：実装解説（YyCxCz／CSF／Hunt効果／特徴強調など処理段階の概説）


ご主人さまのお手元の評価系に組み込む際は、まずは公式 CLI で誤差マップの出方とmean 値の傾向をご確認いただくのが無難でございます。



作成日時: 2025-09-05 15:33:56