# メモ

はい、ご主人さま。
venv 内では --user は使えません（設計上、仮想環境と “ユーザーサイト” を混ぜないために禁止されています）。正しいやり方を2通り書きます。


---

方式A（おすすめ）：--system-site-packages 付きで venv を作り直す

※ python3-recoll（APT）の Recoll Pythonバインディングを venv から見えるようにするため。

# 1) Recoll 本体とPythonバインディング（WSL2 Ubuntu）
sudo apt update
sudo apt install -y recoll python3-recoll poppler-utils

# 2) venv を作り直し（←ここが重要）
python3 -m venv ~/.venvs/recoll --system-site-packages
source ~/.venvs/recoll/bin/activate
python -m pip install -U pip
python -m pip install recoll-webui waitress

# 3) 初回インデックス（必要なら）
recollindex -z

# 4) WebUI 起動
~/.venvs/recoll/bin/recollwebui -a 127.0.0.1 -p 4711 -c ~/.recoll
# → Windowsのブラウザで http://127.0.0.1:4711/

> 確認：python -c "import recoll; print(recoll.__file__)" で …/dist-packages/recoll/__init__.py が表示されればOKです。




---

方式B（作り直したくない場合）：既存 venv に system site を見せる

既存 venv は後から --system-site-packages に切り替えられません。代替として 一時的に PYTHONPATH を追加します。

# 1) APTでRecollバインディングを入れていなければ入れる
sudo apt install -y python3-recoll

# 2) 既存 venv を有効化
source /path/to/your-venv/bin/activate

# 3) venv から system の dist-packages を見せる
export PYTHONPATH="/usr/lib/python3/dist-packages:${PYTHONPATH}"

# 4) WebUI を venv にインストール（--user なし）
python -m pip install -U pip
python -m pip install recoll-webui waitress

# 5) 起動
recollwebui -a 127.0.0.1 -p 4711 -c ~/.recoll

> 確認：python -c "import recoll" がエラーなく通ればOKです。恒久化したい場合は、上記 export PYTHONPATH=… を venv の bin/activate の末尾に1行追記します。




---

補足

--user は venv 外でのみ使用します。venv 内では付けずに pip install してください。

recollwebui の実体は venv の …/bin/recollwebui に入ります（PATH が通っていなければフルパスで実行）。

WebUI は -a 127.0.0.1 でローカル専用待受、インデックス設定は ~/.recoll/recoll.conf（topdirs=/mnt/c/... など）。

/mnt/c 等の Windows ドライブは inotify が効かないため、リアルタイム監視ではなく recollindex の定期実行で追従します。




作成日時: 2025-10-08 10:26:09